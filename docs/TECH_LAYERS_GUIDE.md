# Argus 技術レイヤーガイド — 現代 Web 技術の全体像

> エンジニア転職を目指す人・プロダクトマネージャー向けの包括リファレンス。
> 各技術を「なぜ必要か」「身近なたとえ」「競合との比較」「Argus での採用理由」の 4 軸で解説する。

---

## 目次

1. [実行環境 / インフラ](#1-実行環境--インフラ)
   - [ホスティング](#11-ホスティング)
   - [サーバー形態](#12-サーバー形態)
   - [ランタイム](#13-ランタイム)
   - [Edge 計算](#14-edge-計算)
   - [ネットワーク](#15-ネットワーク)
2. [アプリ / フレームワーク](#2-アプリ--フレームワーク)
   - [Web フレームワーク](#21-web-フレームワーク)
   - [API フレームワーク](#22-api-フレームワーク)
   - [レンダリング方式](#23-レンダリング方式)
   - [認証方式](#24-認証方式)
   - [リアルタイム通信](#25-リアルタイム通信)
3. [データ](#3-データ)
   - [DB 種別](#31-db-種別)
   - [検索](#32-検索)
   - [キャッシュ](#33-キャッシュ)
   - [キュー / メッセージング](#34-キュー--メッセージング)
   - [スキーマ管理](#35-スキーマ管理)
4. [ストレージ / 配信](#4-ストレージ--配信)
   - [オブジェクトストレージ](#41-オブジェクトストレージ)
   - [CDN](#42-cdn)
   - [画像 / 動画処理](#43-画像--動画処理)
   - [署名 URL](#44-署名-url)
5. [開発 / 品質](#5-開発--品質)
   - [パッケージ管理](#51-パッケージ管理)
   - [モノレポ](#52-モノレポ)
   - [テスト種類](#53-テスト種類)
   - [テストフレームワーク](#54-テストフレームワーク)
   - [Lint / Format](#55-lint--format)
   - [CI/CD](#56-cicd)
   - [IaC](#57-iac)
   - [Observability](#58-observability)
6. [セキュリティ / ガバナンス](#6-セキュリティ--ガバナンス)
   - [認可方式](#61-認可方式)
   - [秘密情報管理](#62-秘密情報管理)
   - [CORS / CSRF](#63-cors--csrf)
   - [レート制限](#64-レート制限)
   - [監査ログ](#65-監査ログ)
   - [脆弱性スキャン](#66-脆弱性スキャン)

---

## 1. 実行環境 / インフラ

### 1.1 ホスティング

#### ひとことまとめ

アプリケーションを動かす「場所」を提供するサービス。自分でサーバーを買わなくても、クラウド上でプログラムを実行できる。

#### 身近なたとえ

> お店を開くとき、自分で土地を買って建物を建てる（オンプレミス）か、テナントを借りる（クラウド）かの違い。テナントにも「フードコートの一区画（サーバーレス）」「1フロア丸ごと（VPS）」「ビル一棟（専用サーバー）」といった選択肢がある。

#### 選択肢の比較

| サービス            | 特徴                           | 身近なたとえ                   | 向いている用途                  | Argus の選択 |
| ------------------- | ------------------------------ | ------------------------------ | ------------------------------- | ------------ |
| **ローカルMac+PM2** | コスト0。常時稼働Macで直接実行 | 自宅（追加コストゼロ）         | 個人開発で常時稼働Macがある場合 | **採用**     |
| **Vercel**          | Next.js 公式。サーバーレス中心 | フードコート（手軽、制限あり） | フロントエンド中心の Web サイト | —            |
| **Fly.io**          | コンテナを世界中のエッジで実行 | 移動販売車（どこでも出店）     | 低レイテンシが重要な API        | —            |
| **EC2 (AWS)**       | 最も自由度が高い仮想サーバー   | ビルの一室を自由に改装         | 大規模・細かい制御が必要な場合  | —            |

> **平たく言うと**: Argus はローカルMac上で PM2 を使って直接実行している。すでに24時間稼働しているMacがあるため、追加のサーバー費用がゼロで済み、開発環境とのシームレスな連携が可能。Cloudflare Tunnel + Access でダッシュボードを安全に外部公開している。

#### Argus での採用理由

ローカルMac + PM2 を採用。Slack Bot は常時接続（Socket Mode）で動き続ける必要があり、サーバーレスでは対応できない。すでに24時間稼働しているMacがあるため、PM2でプロセスを管理し、LaunchAgentで自動起動する構成が最もコスト効率が良い。Cloudflare Tunnel でダッシュボードを外部公開している。

---

### 1.2 サーバー形態

#### ひとことまとめ

「どんな形でプログラムを動かすか」の選択。サーバーレス・コンテナ・VPS はそれぞれ自由度とコストのバランスが異なる。

#### 身近なたとえ

> - **サーバーレス**: タクシー（乗った分だけ課金、待機中は無料）
> - **コンテナ（Docker）**: キャンピングカー（必要なものを詰め込んで移動可能）
> - **VPS（仮想マシン）**: 賃貸アパート（1部屋を占有、自由にレイアウト）

| 形態              | 特徴                 | 身近なたとえ     | メリット                 | デメリット                     | Argus の選択 |
| ----------------- | -------------------- | ---------------- | ------------------------ | ------------------------------ | ------------ |
| サーバーレス      | リクエスト単位で起動 | タクシー         | コスト最小、スケール自動 | 常時接続不可、コールドスタート | —            |
| コンテナ (Docker) | アプリ+依存を箱詰め  | キャンピングカー | 環境再現性、移植性       | オーケストレーション必要       | —            |
| VPS               | 仮想サーバー丸ごと   | 賃貸アパート     | 自由度最大               | 自分で管理                     | **採用**     |

> **平たく言うと**: Argus は「賃貸アパート型（VPS）」を選んでいる。常に Slack の会話を聞き続ける必要があるので、「使ったときだけ起動するタクシー型」では対応できない。

---

### 1.3 ランタイム

#### ひとことまとめ

JavaScript / TypeScript を実行するエンジン。ブラウザ以外で JavaScript を動かすために必要。

#### 身近なたとえ

> プログラミング言語が「レシピ」だとすると、ランタイムは「キッチン」。同じレシピでも使うキッチン（設備）によって調理スピードや使える器具が変わる。

| ランタイム  | 特徴                                   | 身近なたとえ                             | Argus の選択           |
| ----------- | -------------------------------------- | ---------------------------------------- | ---------------------- |
| **Node.js** | 最も普及。npm エコシステムが巨大       | 業務用キッチン（道具が豊富）             | **採用（>= 22.12.0）** |
| **Deno**    | セキュリティ重視。Node.js 作者が再設計 | オール電化キッチン（安全、互換性に課題） | —                      |
| **Bun**     | 超高速。Node.js 互換を目指す           | 最新式キッチン（速いが新しい）           | —                      |

> **平たく言うと**: Argus は Node.js を使っている。npm パッケージ（世界最大のプログラム部品ライブラリ）との互換性が最も高く、Claude SDK や Slack Bolt など必要なライブラリがすべて安定して動く。

---

### 1.4 Edge 計算

#### ひとことまとめ

ユーザーに物理的に近い場所（CDN のサーバー群）でプログラムを実行する仕組み。通信の往復時間を短縮できる。

#### 身近なたとえ

> 本社（オリジンサーバー）に電話するより、最寄りの支店（Edge ノード）に聞いた方が早い。ただし支店でできることは限られている。

| 方式                 | 特徴                 | 身近なたとえ         |
| -------------------- | -------------------- | -------------------- |
| **Edge 実行**        | CDN ノードで処理     | 最寄りの支店で即回答 |
| **オリジンサーバー** | 中央のサーバーで処理 | 本社に問い合わせ     |

> **平たく言うと**: Argus では Cloudflare Tunnel 経由でアクセスするため、Cloudflare のネットワークを通るが、AI 処理やデータベースアクセスはローカルMac上で行っている。Edge 側ではセキュリティ（Cloudflare Access による認証）と通信の暗号化を担当している。

---

### 1.5 ネットワーク

#### ひとことまとめ

アプリケーションをインターネット上でどう隔離・公開するかの設計。不正アクセスを防ぎつつ、必要な通信だけを通す。

#### 身近なたとえ

> - **VPC**: マンション全体の敷地（外部と隔離された空間）
> - **パブリックサブネット**: マンションのエントランス（外から入れる場所）
> - **プライベートサブネット**: マンションの各部屋（エントランスを通らないと入れない）

> **平たく言うと**: Argus では Cloudflare Tunnel がこの「マンションのエントランス」の役割を果たしている。外部からは Cloudflare を経由しないとローカルMac上のサーバーにアクセスできない。さらに Cloudflare Access でメール認証をかけているので、許可された人だけがダッシュボードに入れる。

---

## 2. アプリ / フレームワーク

### 2.1 Web フレームワーク

#### ひとことまとめ

Web アプリケーションを効率的に構築するための「型」。ルーティング、レンダリング、データ取得などの共通処理をまとめて提供する。

#### 身近なたとえ

> 料理でいう「レシピ本 + 専用調理器具セット」。一から全部自分で作ることもできるが、フレームワークを使えば定番の処理はすでに用意されている。

| フレームワーク | 言語           | 特徴                            | 身近なたとえ               | Argus の選択    |
| -------------- | -------------- | ------------------------------- | -------------------------- | --------------- |
| **Next.js**    | React (JS/TS)  | SSR/SSG/RSC 全対応。Vercel 開発 | 多機能スイスアーミーナイフ | **採用（v16）** |
| **Nuxt**       | Vue (JS/TS)    | Vue 版の Next.js                | Vue 好きの万能ナイフ       | —               |
| **SvelteKit**  | Svelte (JS/TS) | 軽量、コンパイル時最適化        | 軽量カーボンナイフ         | —               |
| **Remix**      | React (JS/TS)  | Web 標準重視、フォーム処理得意  | クラシックな実用ナイフ     | —               |

> **平たく言うと**: Argus のダッシュボード（管理画面）は Next.js 16 で構築されている。React のエコシステムが豊富で、サーバーサイドレンダリング（ページ表示が速い技術）にも対応しているため、管理画面のような情報量の多い画面に適している。

---

### 2.2 API フレームワーク

#### ひとことまとめ

「データのやり取り窓口（API）」を構築するためのフレームワーク。フロントエンドや外部サービスからのリクエストを受け取り、処理して返す。

#### 身近なたとえ

> レストランの注文カウンター。お客さん（フロントエンド）が「カレーください」とリクエストすると、厨房（ビジネスロジック）に伝えて料理（データ）を返す。

| フレームワーク | 言語         | 特徴                                 | 身近なたとえ                 | Argus の選択   |
| -------------- | ------------ | ------------------------------------ | ---------------------------- | -------------- |
| **Express**    | Node.js      | 最も普及。シンプル、ミドルウェア豊富 | 老舗の定食屋（信頼と実績）   | **採用（v5）** |
| **NestJS**     | Node.js      | Angular 風の構造化フレームワーク     | 高級レストラン（格式あり）   | —              |
| **Hono**       | Node.js/Edge | 超軽量、Edge 実行対応                | フードトラック（軽量・高速） | —              |
| **FastAPI**    | Python       | Python 製。型安全、自動ドキュメント  | AI/ML 御用達の専門店         | —              |

> **平たく言うと**: Argus の agent-orchestrator（AI エージェントを制御するバックエンド）は Express で構築されている。Node.js 界で最も使われているフレームワークで、ミドルウェア（リクエスト処理の部品）が豊富。Claude SDK や Slack Bolt と同じ Node.js で統一できるメリットもある。

---

### 2.3 レンダリング方式

#### ひとことまとめ

Web ページを「どこで・いつ HTML に変換するか」の方式。表示速度、SEO、開発体験に大きく影響する。

#### 身近なたとえ

> - **SPA**: お客さんに食材キット（JavaScript）を渡して「自分で料理して」（ブラウザで組み立て）
> - **SSR**: 注文を受けてから厨房で調理して提供（サーバーでページ生成）
> - **SSG**: 事前に弁当を作り置き（ビルド時に全ページ生成）
> - **RSC**: 厨房で下ごしらえ、仕上げだけテーブルで（サーバーとクライアントの分担）

| 方式 | タイミング                          | 身近なたとえ      | メリット                     | デメリット            |
| ---- | ----------------------------------- | ----------------- | ---------------------------- | --------------------- |
| SPA  | ブラウザで生成                      | 食材キット        | インタラクティブ             | 初回表示遅い、SEO弱い |
| SSR  | リクエスト時にサーバーで生成        | 注文後に調理      | SEO◎、初回表示速い           | サーバー負荷          |
| SSG  | ビルド時に全ページ生成              | 弁当の作り置き    | 最速、CDN配信可能            | 動的コンテンツ不向き  |
| RSC  | サーバーコンポーネント+クライアント | 下ごしらえ+仕上げ | バンドル削減、データ取得効率 | 学習コスト            |

> **平たく言うと**: Argus のダッシュボードは Next.js 16 の RSC（React Server Components）を活用している。セッション一覧やナレッジ管理のようにデータベースから情報を取得する画面は、サーバー側で HTML を生成して高速に表示し、ボタン操作のようなインタラクティブな部分だけクライアント（ブラウザ）で処理する。

---

### 2.4 認証方式

#### ひとことまとめ

「この人は誰か（認証: Authentication）」を確認する仕組み。ログイン機能の裏側で動いている技術。

#### 身近なたとえ

> - **JWT**: 入場パスポート（本人が持ち歩く。偽造防止の署名入り）
> - **Session**: ホテルのルームキー（ホテル側が管理、紛失したらフロントで再発行）
> - **OAuth2**: 「Google でログイン」ボタン（信頼できる第三者に身元確認を委託）
> - **API Key**: 合言葉（シンプルだが漏洩リスクあり）

| 方式    | 仕組み                               | 身近なたとえ         | 主な用途                    |
| ------- | ------------------------------------ | -------------------- | --------------------------- |
| JWT     | 署名付きトークンをクライアントが保持 | パスポート           | SPA、マイクロサービス間通信 |
| Session | サーバー側でセッション情報を管理     | ホテルのルームキー   | 従来型 Web アプリ           |
| OAuth2  | 外部プロバイダーに認証を委託         | 「Googleでログイン」 | SNS 連携、API アクセス      |
| API Key | 固定の文字列で認証                   | 合言葉               | サーバー間通信、外部 API    |

> **平たく言うと**: Argus では複数の認証方式を場面に応じて使い分けている。Dashboard のアクセス制御には Cloudflare Access（メール認証）、Gmail/Calendar 連携には OAuth2、外部 API（Claude, Slack）との通信には API Key を使っている。

---

### 2.5 リアルタイム通信

#### ひとことまとめ

サーバーとクライアント間で「即座に」データをやり取りする仕組み。チャットや通知のように「待たずに情報が届く」機能に不可欠。

#### 身近なたとえ

> - **WebSocket**: 電話（双方向、常時接続）
> - **SSE**: ラジオ放送（サーバーから一方向に流れ続ける）
> - **Polling**: 定期的に「新しい情報ある？」と聞きに行く（5分おきに郵便受けを確認）

| 方式      | 方向                  | 身近なたとえ | メリット           | デメリット           |
| --------- | --------------------- | ------------ | ------------------ | -------------------- |
| WebSocket | 双方向                | 電話         | リアルタイム性最高 | 接続管理が複雑       |
| SSE       | サーバー→クライアント | ラジオ放送   | シンプル、HTTP互換 | 双方向不可           |
| Polling   | クライアント→サーバー | 郵便受け確認 | 実装最も簡単       | 無駄なリクエスト多い |

> **平たく言うと**: Argus の Slack Bot は WebSocket ベースの Socket Mode で Slack と常時接続している。ユーザーがメッセージを送った瞬間に受け取れるため、「Slack に話しかけたら即座に AI が応答する」体験が実現できる。

---

## 3. データ

### 3.1 DB 種別

#### ひとことまとめ

データを永続的に保存・検索する仕組み。用途によって最適な DB の種類が異なる。

#### 身近なたとえ

> - **RDB**: Excel の表（行と列が整然と並ぶ。関連する表をリンクできる）
> - **NoSQL（ドキュメント型）**: 付箋メモの束（自由な形式で書ける。検索は得意だが関連付けは苦手）
> - **グラフ DB**: 人間関係図（「誰が誰とつながっているか」を高速に探索）

| DB 種別             | 代表製品          | 特徴                           | 身近なたとえ | Argus の選択        |
| ------------------- | ----------------- | ------------------------------ | ------------ | ------------------- |
| **RDB**             | PostgreSQL, MySQL | 構造化データ、ACID 準拠        | Excel の表   | **PostgreSQL 採用** |
| **ドキュメント DB** | MongoDB, DynamoDB | スキーマレス、スケールしやすい | 付箋メモの束 | —                   |
| **グラフ DB**       | Neo4j             | 関係性の探索が高速             | 人間関係図   | —                   |

> **平たく言うと**: Argus は Supabase 上の PostgreSQL を使っている。セッション、メッセージ、タスク、ナレッジなど「表形式で整理できるデータ」が中心であり、データ間の関連（「このメッセージはどのセッションに属するか」）を正確に管理する必要があるため、RDB が最適。

---

### 3.2 検索

#### ひとことまとめ

大量のデータの中から目的の情報を素早く見つける技術。「キーワード検索」と「意味検索」の 2 種類がある。

#### 身近なたとえ

> - **全文検索**: 本の巻末索引（キーワードでページを探す）
> - **ベクトル DB**: 図書館の司書（「○○に似た本ありますか？」と意味で探してくれる）

| 検索方式         | 代表製品                      | 特徴                             | 身近なたとえ |
| ---------------- | ----------------------------- | -------------------------------- | ------------ |
| **全文検索**     | PostgreSQL FTS, Elasticsearch | キーワード一致で高速検索         | 巻末索引     |
| **ベクトル検索** | pgvector, Pinecone            | 意味的に近いものを検索（AI活用） | 司書に相談   |

> **平たく言うと**: Argus ではナレッジベース（知識の蓄積庫）の検索に PostgreSQL の全文検索機能を活用しつつ、AI（Claude）による意味理解で検索精度を高めている。

---

### 3.3 キャッシュ

#### ひとことまとめ

よく使うデータを「手元」に一時保存して、毎回データベースに問い合わせなくて済むようにする仕組み。

#### 身近なたとえ

> よく使う電話番号をスマホの「お気に入り」に登録するようなもの。毎回電話帳（データベース）を最初からめくるより、お気に入り（キャッシュ）から一発で見つかる。

| キャッシュ         | 特徴                           | 身近なたとえ                       |
| ------------------ | ------------------------------ | ---------------------------------- |
| **Redis**          | インメモリ。豊富なデータ構造   | デスクの付箋（すぐ手が届く）       |
| **Memcached**      | シンプルな Key-Value ストア    | 電話帳のお気に入り                 |
| **CDN キャッシュ** | 世界中の拠点にコンテンツを複製 | コンビニの雑誌棚（どこでも買える） |

> **平たく言うと**: Argus では CDN キャッシュ（Cloudflare）を静的ファイル配信に活用している。ダッシュボードの JavaScript ファイルや画像は、ユーザーに近い Cloudflare のサーバーから高速に配信される。

---

### 3.4 キュー / メッセージング

#### ひとことまとめ

「今すぐ処理しなくていいタスク」を順番待ちの列（キュー）に入れて、後から順番に処理する仕組み。

#### 身近なたとえ

> 病院の受付番号札。患者（タスク）が来たら番号札を渡して待合室（キュー）で待ってもらい、医師（ワーカー）が順番に診察する。急患（優先度の高いタスク）は割り込みもできる。

| キュー       | 特徴                       | 身近なたとえ         | 主な用途                   |
| ------------ | -------------------------- | -------------------- | -------------------------- |
| **SQS**      | AWS マネージド。高可用性   | 大病院の受付システム | AWS エコシステム内         |
| **RabbitMQ** | 柔軟なルーティング         | 郵便局の仕分け       | 複雑なメッセージパターン   |
| **Kafka**    | 大量データのストリーム処理 | 高速道路の料金所     | ログ収集、イベント駆動     |
| **BullMQ**   | Node.js + Redis ベース     | 町の郵便局（手軽）   | Node.js アプリの非同期処理 |

> **平たく言うと**: Argus では AI エージェントのタスク実行をスケジューリングする仕組みとして、データベースベースのキュー管理を採用している。タスクテーブルにステータス（待機中、実行中、完了）を持たせ、agent-orchestrator が順番に処理する。

---

### 3.5 スキーマ管理

#### ひとことまとめ

データベースの「設計図」を変更するとき、その変更履歴を追跡・管理する仕組み。チーム全員のデータベースを同じ状態に保つ。

#### 身近なたとえ

> 間取り図の変更履歴。「リビングを広げた（v2）」「キッチンにカウンターを追加した（v3）」のように、変更を1つずつ記録しておくことで、どの時点の状態にも戻せる。

| ツール      | 言語       | 特徴                       | 身近なたとえ                   | Argus の選択 |
| ----------- | ---------- | -------------------------- | ------------------------------ | ------------ |
| **Drizzle** | TypeScript | 型安全、軽量、SQL に近い   | 設計図を鉛筆で手書き（直感的） | **採用**     |
| **Prisma**  | TypeScript | 独自スキーマ言語、GUI あり | CAD ソフト（高機能だが重い）   | —            |
| **Flyway**  | Java/SQL   | SQL ファイルベース         | 手書き図面をファイリング       | —            |

> **平たく言うと**: Argus は Drizzle ORM のマイグレーション機能を使っている。TypeScript でスキーマを定義するため、「コードとデータベースの設計が常に一致している」ことをコンパイラが保証してくれる。変更には `drizzle-kit generate --custom` で意味のある名前を付ける運用ルール（例: `add-session-indexes`）を採用。

---

## 4. ストレージ / 配信

### 4.1 オブジェクトストレージ

#### ひとことまとめ

画像・動画・ファイルなどの大きなデータを保存するサービス。データベースには向かない大容量ファイルの保管場所。

#### 身近なたとえ

> トランクルーム（貸し倉庫）。家（データベース）に入りきらない大きな荷物（ファイル）を預けておき、必要なときに取り出す。

| サービス          | 提供元       | 特徴                              | 身近なたとえ               | Argus の選択 |
| ----------------- | ------------ | --------------------------------- | -------------------------- | ------------ |
| **S3**            | AWS          | 業界標準。最も多機能              | 大手倉庫会社（信頼性抜群） | —            |
| **Cloudflare R2** | Cloudflare   | S3 互換。エグレス（取り出し）無料 | 出庫料無料の倉庫           | **採用**     |
| **GCS**           | Google Cloud | BigQuery 連携が強い               | Google 系列の倉庫          | —            |

> **平たく言うと**: Argus は Cloudflare R2 を使っている。S3 と同じ API（操作方法）が使えるうえに、ファイルを取り出す（ダウンロードする）ときの通信料が無料。AI が生成した画像や動画を Slack に配信するときのコストを抑えられる。

#### Argus での採用理由

Cloudflare R2 を採用。Argus は AI が生成したコンテンツ（動画・画像）を Slack 経由で配信するため、エグレスコスト（データ取り出し料金）が積み重なる。R2 はエグレス無料のため、配信量を気にせず使える。また Cloudflare Tunnel/Access と同じエコシステムなので、認証・配信の設定が統一的に管理できる。

---

### 4.2 CDN

#### ひとことまとめ

世界中に分散配置されたサーバーネットワークで、コンテンツをユーザーの近くから高速配信する仕組み。

#### 身近なたとえ

> 全国チェーンのコンビニ。東京の工場（オリジンサーバー）で作った商品を、北海道から沖縄まで各店舗（CDN ノード）に配送しておく。お客さんは最寄りの店舗から買えるので早い。

| CDN            | 提供元     | 特徴                             | 身近なたとえ             | Argus の選択 |
| -------------- | ---------- | -------------------------------- | ------------------------ | ------------ |
| **Cloudflare** | Cloudflare | 無料プランあり。セキュリティ統合 | セキュリティ付きコンビニ | **採用**     |
| **CloudFront** | AWS        | AWS エコシステムと統合           | AWS 系列のコンビニ       | —            |
| **Fastly**     | Fastly     | リアルタイム設定変更             | 即座に品揃え変更できる店 | —            |

> **平たく言うと**: Argus は Cloudflare を CDN として使っている。Cloudflare Tunnel（安全なトンネル通信）、Cloudflare Access（認証）、Cloudflare R2（ストレージ）と合わせて「Cloudflare 一本」でセキュリティと配信を統一管理している。

---

### 4.3 画像 / 動画処理

#### ひとことまとめ

画像のリサイズ・圧縮・フォーマット変換や、動画の編集・トランスコードを行うツール・サービス。

#### 身近なたとえ

> - **Cloudinary / Imgix**: 写真のプリントサービス（「L判で」「セピアで」と指定するだけ）
> - **ffmpeg**: プロ用の編集室（何でもできるが操作は複雑）

| ツール         | 種別       | 特徴                    | 身近なたとえ             |
| -------------- | ---------- | ----------------------- | ------------------------ |
| **Cloudinary** | SaaS       | URL パラメータで変換    | ワンクリック写真プリント |
| **Imgix**      | SaaS       | リアルタイム画像変換    | 写真のオンデマンド印刷   |
| **ffmpeg**     | OSS ツール | 動画/音声のあらゆる変換 | プロ用編集室             |

> **平たく言うと**: Argus ではダッシュボードの Files API を通じて MP4/MP3 ファイルを配信している。R2 にアップロードされたメディアファイルを、ダッシュボード経由で Slack に URL として共有する仕組み。

---

### 4.4 署名 URL

#### ひとことまとめ

「期限付き・1回限りの特別な URL」を発行して、認証なしではアクセスできないファイルを一時的に公開する仕組み。

#### 身近なたとえ

> 美術館の限定チケット。「2025年3月1日まで有効、1名限り」のように期限と条件が付いている。チケット（署名 URL）があれば入れるが、期限が切れたら無効になる。

**仕組み**:

1. サーバーが秘密鍵でURLに「署名（電子的なハンコ）」を付ける
2. クライアントはその署名付きURLでファイルにアクセス
3. ストレージ側が署名を検証し、有効期限内なら配信
4. 期限が切れた URL はアクセス不可

> **平たく言うと**: Argus では R2 に保存されたファイルへのアクセスに署名 URL を活用できる。「この画像を30分だけ見られるリンク」を Slack に送ることで、認証なしで一時的にファイルを共有しつつ、永続的な公開は防いでいる。

---

## 5. 開発 / 品質

### 5.1 パッケージ管理

#### ひとことまとめ

外部ライブラリ（プログラムの部品）のインストール・バージョン管理を行うツール。

#### 身近なたとえ

> 料理でいう「食材の仕入れ業者」。npm レジストリ（市場）から必要な部品（パッケージ）を仕入れて、レシピ通りのバージョンで揃える。

| ツール   | 特徴                          | 身近なたとえ                         | Argus の選択     |
| -------- | ----------------------------- | ------------------------------------ | ---------------- |
| **npm**  | Node.js 標準。最も普及        | 大手スーパー（品揃え豊富、やや遅い） | —                |
| **yarn** | npm の高速版として登場        | 会員制スーパー（速いがルールあり）   | —                |
| **pnpm** | ディスク効率◎、厳格な依存管理 | 業務用仕入れ（無駄なし、厳格）       | **採用（10.x）** |

> **平たく言うと**: Argus は pnpm を使っている。1つのプロジェクト内に複数のアプリ（slack-bot, dashboard, orchestrator）がある「モノレポ」構成で、pnpm は各アプリが使うライブラリを効率的に共有しつつ、依存関係の衝突を厳格に防いでくれる。

---

### 5.2 モノレポ

#### ひとことまとめ

複数のアプリやライブラリを「1つのリポジトリ（コード保管庫）」で管理する手法。

#### 身近なたとえ

> 1つのビルに複数のテナント（アプリ）が入っている「商業ビル」。ビル全体の管理（セキュリティ、電気、水道）は共通化しつつ、各テナントは独立して営業できる。

| ツール              | 特徴                         | 身近なたとえ             | Argus の選択 |
| ------------------- | ---------------------------- | ------------------------ | ------------ |
| **Turborepo**       | キャッシュ・並列ビルドに強い | スマートビル管理システム | —            |
| **Nx**              | 大規模向け。依存グラフ可視化 | 大規模商業施設の管理会社 | —            |
| **Lerna**           | 元祖モノレポツール           | 老舗ビル管理会社         | —            |
| **pnpm workspaces** | pnpm 内蔵。追加ツール不要    | ビルオーナーが自分で管理 | **採用**     |

> **平たく言うと**: Argus は pnpm workspaces でモノレポを管理している。12 個のパッケージ（slack-bot, dashboard, agent-core, db など）を1つのリポジトリで管理し、共通コード（DB アクセス、型定義など）を簡単に共有できる。別途 Turborepo などを入れなくても、pnpm の機能だけで十分な規模。

---

### 5.3 テスト種類

#### ひとことまとめ

プログラムが正しく動くことを自動確認する仕組み。範囲によって Unit（部品）、Integration（結合）、E2E（全体）に分かれる。

#### 身近なたとえ

> 自動車の品質検査に例えると:
>
> - **Unit テスト**: 各部品（エンジン、ブレーキ）の単体検査
> - **Integration テスト**: 部品を組み合わせた検査（エンジン＋トランスミッション）
> - **E2E テスト**: 完成車を実際に走らせる試走検査

| テスト種類      | 範囲             | 速度       | 身近なたとえ   | コスト |
| --------------- | ---------------- | ---------- | -------------- | ------ |
| **Unit**        | 関数・クラス単位 | 非常に速い | 部品の単体検査 | 低い   |
| **Integration** | モジュール結合   | 普通       | 組み合わせ検査 | 中程度 |
| **E2E**         | ユーザー操作全体 | 遅い       | 完成車の試走   | 高い   |

> **平たく言うと**: Argus では 1,200 以上のテストを Vitest で自動実行している。大部分は Unit テストで、コードを変更するたびに「既存の機能が壊れていないか」を数秒で確認できる。

---

### 5.4 テストフレームワーク

#### ひとことまとめ

テストコードを書いて実行するためのツール。テストの記述方法、実行速度、対応範囲が異なる。

| フレームワーク | 種類             | 特徴                                | 身近なたとえ             | Argus の選択   |
| -------------- | ---------------- | ----------------------------------- | ------------------------ | -------------- |
| **Jest**       | Unit/Integration | Facebook 製。デファクトスタンダード | 定番の検査機器           | —              |
| **Vitest**     | Unit/Integration | Vite ベース。Jest 互換で高速        | 次世代の高速検査機器     | **採用（v4）** |
| **Playwright** | E2E              | Microsoft 製。マルチブラウザ対応    | ロボットがブラウザを操作 | —              |
| **Cypress**    | E2E              | 開発者体験が良い。リアルタイム確認  | モニター付き検査ロボット | —              |

> **平たく言うと**: Argus は Vitest を使っている。Jest（従来の定番）と書き方はほぼ同じだが、ESM（最新の JavaScript モジュール方式）にネイティブ対応しており、テスト実行が格段に速い。TypeScript の変換も不要で、そのまま実行できる。

---

### 5.5 Lint / Format

#### ひとことまとめ

コードの品質チェック（Lint）と書き方の統一（Format）を自動で行うツール。チーム全員のコードスタイルを揃える。

#### 身近なたとえ

> - **Lint**: 文章の校閲者（誤字脱字、文法ミスを指摘）
> - **Format**: 印刷会社のレイアウト（余白、フォント、行間を統一）

| ツール       | 役割          | 特徴                                      | 身近なたとえ         |
| ------------ | ------------- | ----------------------------------------- | -------------------- |
| **ESLint**   | Lint          | ルールが豊富。プラグインで拡張            | ベテラン校閲者       |
| **Biome**    | Lint + Format | Rust 製で高速。ESLint + Prettier の一体型 | AI 校閲 + レイアウト |
| **Prettier** | Format        | コードの見た目を統一                      | 自動レイアウトソフト |

> **平たく言うと**: Argus では Prettier でコードフォーマット（ダブルクォート、セミコロンあり、末尾カンマあり）を統一している。

---

### 5.6 CI/CD

#### ひとことまとめ

コードの変更を自動的にテスト（CI: Continuous Integration）し、本番環境にデプロイ（CD: Continuous Delivery）する仕組み。

#### 身近なたとえ

> 工場のベルトコンベア。材料（コード）を投入すると、自動的に検品（テスト）→ 梱包（ビルド）→ 出荷（デプロイ）まで流れる。不良品（テスト失敗）は途中で弾かれる。

| サービス           | 特徴                       | 身近なたとえ                | Argus の選択 |
| ------------------ | -------------------------- | --------------------------- | ------------ |
| **GitHub Actions** | GitHub 統合。YAML 定義     | GitHub 内蔵のベルトコンベア | —            |
| **CircleCI**       | 高速。並列実行得意         | 高速ベルトコンベア          | —            |
| **PM2 + 手動**     | ローカルで直接ビルド・起動 | 自家製ベルトコンベア        | **採用**     |

> **平たく言うと**: Argus はローカルMac上で `pnpm build` してから `pm2 restart all` で反映している。LaunchAgent で Mac 起動時に自動起動する設定もある。個人開発の現在の規模では、CI/CD パイプラインを構築するオーバーヘッドが不要。

---

### 5.7 IaC

#### ひとことまとめ

IaC（Infrastructure as Code）は、サーバーやネットワークの設定を「コード」で管理する手法。手動設定のミスを防ぎ、環境を再現可能にする。

#### 身近なたとえ

> 家具の配置を「設計図」で管理するイメージ。「リビングにソファ、寝室にベッド」と図面に書いておけば、引越し先でも同じ配置を再現できる。手作業で家具を並べる（手動設定）と、毎回微妙にずれる。

| ツール        | 言語                 | 特徴                           | 身近なたとえ               |
| ------------- | -------------------- | ------------------------------ | -------------------------- |
| **Terraform** | HCL                  | マルチクラウド対応の業界標準   | 万能設計ソフト             |
| **CDK**       | TypeScript/Python    | AWS リソースをプログラムで定義 | AWS 専用 CAD               |
| **Pulumi**    | TypeScript/Python/Go | プログラミング言語で定義       | プログラマー向け設計ソフト |

> **平たく言うと**: Argus の現在の規模ではローカルMac + PM2 + Cloudflare の設定で十分に管理できているため、IaC ツールは導入していない。サービスが成長してインフラが複雑化した場合に導入を検討する領域。

---

### 5.8 Observability

#### ひとことまとめ

本番環境で「何が起きているか」を把握する仕組み。ログ（記録）、メトリクス（数値）、トレース（追跡）の3本柱。

#### 身近なたとえ

> 病院の健康管理に例えると:
>
> - **ログ**: カルテ（何が起きたかの記録）
> - **メトリクス**: 健康診断の数値（体温、血圧、心拍数）
> - **トレース**: 精密検査（1つの症状を追いかけて原因を特定）

| 柱             | 代表ツール            | 役割               | 身近なたとえ   |
| -------------- | --------------------- | ------------------ | -------------- |
| **ログ**       | Winston, pino         | イベントの記録     | カルテ         |
| **メトリクス** | Prometheus, Grafana   | 数値の監視・可視化 | 健康診断の数値 |
| **トレース**   | OpenTelemetry, Jaeger | リクエストの追跡   | 精密検査       |

> **平たく言うと**: Argus では各エージェントの実行を観測する仕組みが「最重要」と位置付けられている。PreToolUse / PostToolUse フックでツール実行の開始・終了・所要時間・結果を記録し、「何が起きたか」を後から再構成できるようにしている。これはアーキテクチャルールの「観測（最重要）」に対応する設計。

---

## 6. セキュリティ / ガバナンス

### 6.1 認可方式

#### ひとことまとめ

「この人は何ができるか（認可: Authorization）」を制御する仕組み。認証（誰か）の次に来るステップ。

#### 身近なたとえ

> - **RBAC**: 社員証の役職欄で入れる部屋が決まる（「部長」なら会議室A〜Cに入れる）
> - **ABAC**: 条件の組み合わせで判断（「営業部の部長で、勤続5年以上なら入れる」）

| 方式     | 特徴                 | 身近なたとえ         | 向いている場面         |
| -------- | -------------------- | -------------------- | ---------------------- |
| **RBAC** | ロール（役割）ベース | 役職で入退室管理     | ほとんどのアプリ       |
| **ABAC** | 属性の組み合わせ     | 複合条件で入退室管理 | 大規模・複雑な権限要件 |

> **平たく言うと**: Argus では「Collector（収集者）」と「Executor（実行者）」という 2 つのロールで権限を分離している（RBAC 的アプローチ）。Collector は知識の追加・更新・検索ができるが、Executor は検索のみ。最小権限の原則により「壊れにくさ」と「安全」を確保している。

---

### 6.2 秘密情報管理

#### ひとことまとめ

API キー、パスワード、データベース接続情報などの「漏れてはいけない情報」を安全に管理する仕組み。

#### 身近なたとえ

> - **.env ファイル**: 金庫に入れたメモ（手軽だが金庫の鍵管理が必要）
> - **KMS / Vault**: 銀行の貸金庫（厳重だがアクセスに手間）
> - **Secrets Manager**: 秘書が管理する金庫（必要なときに秘書が取り出してくれる）

| ツール                  | 特徴                         | 身近なたとえ         | Argus の選択 |
| ----------------------- | ---------------------------- | -------------------- | ------------ |
| **.env**                | ファイルベース。最もシンプル | メモを金庫に         | **採用**     |
| **AWS KMS**             | 暗号化キーの管理             | 銀行の暗号金庫       | —            |
| **HashiCorp Vault**     | 秘密情報の統合管理           | セキュリティ専門会社 | —            |
| **AWS Secrets Manager** | AWS 統合。自動ローテーション | 秘書付き金庫         | —            |

> **平たく言うと**: Argus はルート `.env` ファイルに環境変数を一本化して管理している。`.env` ファイル自体はリポジトリにコミットしない（`.gitignore` で除外）。個人開発の現在の規模では十分だが、チーム開発に移行する際は Secrets Manager 系の導入を検討する。

---

### 6.3 CORS / CSRF

#### ひとことまとめ

Web アプリケーションを「異なるサイトからの不正なリクエスト」から守る仕組み。

#### 身近なたとえ

> - **CORS（Cross-Origin Resource Sharing）**: 「うちの店の食材は、系列店にだけ卸す」というルール。知らない店（別ドメイン）から「食材ください」と言われたら断る。
> - **CSRF（Cross-Site Request Forgery）**: 詐欺師が「○○銀行の振込用紙」を偽造して、あなたの署名を悪用する攻撃。対策として「秘密の合言葉（CSRF トークン）」を振込用紙に埋め込む。

| 脅威          | 何を防ぐか                                       | 対策方法                       |
| ------------- | ------------------------------------------------ | ------------------------------ |
| **CORS 違反** | 許可していないサイトからの API 呼び出し          | 許可ドメインをサーバーで設定   |
| **CSRF 攻撃** | ログイン中のユーザーの権限を悪用した偽リクエスト | CSRF トークン、SameSite Cookie |

> **平たく言うと**: Argus では Cloudflare Access がリバースプロキシとして機能し、許可されたユーザーからのリクエストのみをバックエンドに転送するため、CORS/CSRF のリスクを大幅に低減している。

---

### 6.4 レート制限

#### ひとことまとめ

一定時間内のリクエスト数を制限する仕組み。サーバーの過負荷や API の不正利用を防ぐ。

#### 身近なたとえ

> 遊園地の「1時間に3回まで」という乗り物制限。全員が無制限に乗ると行列が際限なく伸び、最終的に遊園地（サーバー）がパンクする。

**なぜ必要か**:

- **DoS 攻撃対策**: 大量リクエストでサーバーを止める攻撃を防ぐ
- **API コスト管理**: Claude API など従量課金サービスの暴走を防ぐ
- **公平性確保**: 特定ユーザーのリソース独占を防ぐ

| 実装方法       | 特徴                                 | 身近なたとえ       |
| -------------- | ------------------------------------ | ------------------ |
| **Upstash**    | Redis ベースのサーバーレスレート制限 | クラウド型入場管理 |
| **nginx**      | Web サーバーレベルで制限             | 入口のゲート       |
| **Cloudflare** | CDN レベルで制限                     | 敷地の入口で制限   |

> **平たく言うと**: Argus では Cloudflare がネットワークレベルでのレート制限を提供している。さらに、AI エージェントのタスク実行にはスケジューラーで実行頻度を管理し、Claude API の過剰呼び出しを防いでいる。

---

### 6.5 監査ログ

#### ひとことまとめ

「誰が、いつ、何をしたか」を記録するログ。セキュリティインシデントの調査やコンプライアンス対応に不可欠。

#### 身近なたとえ

> ビルの入退室記録。「田中さんが 14:03 にサーバールームに入室し、14:15 に退室」のように、すべての行動が記録される。何か問題が起きたとき「誰がいつ何をしたか」を追跡できる。

> **平たく言うと**: Argus では AI エージェントの全ツール実行を `agent_executions` テーブルに記録している。「いつ、どのエージェントが、どのツールを、どんな引数で実行し、結果はどうだったか」がすべて追跡可能。これはアーキテクチャルール「観測（最重要）」の一環であり、AI の動作を後から検証できることが安全運用の基盤になっている。

---

### 6.6 脆弱性スキャン

#### ひとことまとめ

プロジェクトが使っているライブラリに「既知のセキュリティ上の弱点」がないかを自動チェックする仕組み。

#### 身近なたとえ

> 車のリコール情報を自動チェックするサービス。自分の車（プロジェクト）が使っている部品（ライブラリ）に欠陥（脆弱性）が見つかったら通知してくれる。

| ツール         | 特徴                      | 身近なたとえ                 | コスト       |
| -------------- | ------------------------- | ---------------------------- | ------------ |
| **npm audit**  | npm 内蔵。手動実行        | 自分でリコール情報を調べる   | 無料         |
| **Dependabot** | GitHub 統合。自動 PR 作成 | ディーラーから連絡＋修理予約 | 無料         |
| **Snyk**       | 高精度。コンテナも対応    | 専門の検査会社               | フリーミアム |

> **平たく言うと**: Argus は GitHub リポジトリで管理されているため、Dependabot が使っているライブラリの脆弱性を自動検出し、修正版への更新を提案する Pull Request を自動作成してくれる。開発者はその PR を確認してマージするだけで、セキュリティを維持できる。

---

## まとめ — Argus の技術選択マップ

| カテゴリ           | Argus の選択                 | 選択理由（一言）                |
| ------------------ | ---------------------------- | ------------------------------- |
| ホスティング       | ローカルMac + PM2            | コスト0、開発環境と統合         |
| プロセス管理       | PM2                          | 常駐サーバーの安定運用          |
| セキュリティ       | Cloudflare Tunnel + Access   | ゼロトラスト、メール認証        |
| Web フレームワーク | Next.js 16                   | RSC 対応、React エコシステム    |
| API フレームワーク | Express 5                    | 最大のエコシステム、シンプル    |
| リアルタイム通信   | Slack Bolt Socket Mode       | Slack との常時接続              |
| DB                 | Supabase PostgreSQL          | マネージド RDB、Drizzle 連携    |
| ORM                | Drizzle ORM + postgres.js    | 型安全、軽量、SQL に近い        |
| ストレージ         | Cloudflare R2                | エグレス無料、S3 互換           |
| CDN                | Cloudflare                   | セキュリティ統合、無料プラン    |
| パッケージ管理     | pnpm 10.x                    | モノレポ対応、ディスク効率      |
| テスト             | Vitest 4 + Testing Library   | ESM ネイティブ、Jest 互換       |
| 言語               | TypeScript 5.x (strict, ESM) | 型安全、保守性                  |
| CI/CD              | PM2 + LaunchAgent            | ローカル手動デプロイ + 自動起動 |
| ランタイム         | Node.js >= 22.12.0           | 最大のエコシステム              |

---

> **このドキュメントについて**: 本ガイドは Argus プロジェクトの技術スタックを「なぜその技術を選んだのか」という観点で、非エンジニアにも理解できるよう解説したものです。各技術の詳細な実装方法や設定については `TECH_STACK_AND_ARCHITECTURE.md` を参照してください。
