<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 920" font-family="'Helvetica Neue', Arial, sans-serif">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1a1a2e"/>
      <stop offset="100%" stop-color="#16213e"/>
    </linearGradient>
    <linearGradient id="card1" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#2d1b4e"/>
      <stop offset="100%" stop-color="#1e1236"/>
    </linearGradient>
    <linearGradient id="card2" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1b3a4e"/>
      <stop offset="100%" stop-color="#122536"/>
    </linearGradient>
    <linearGradient id="card3" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1b4e3a"/>
      <stop offset="100%" stop-color="#123625"/>
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="920" fill="url(#bg)"/>

  <!-- Title -->
  <text x="600" y="48" text-anchor="middle" fill="#e0e0e0" font-size="24" font-weight="bold">Cerberus ToDo 管理フロー</text>
  <text x="600" y="72" text-anchor="middle" fill="#888" font-size="13">inbox 投稿 → 自動分類・保存 → Daily Plan 表示 → 完了管理</text>

  <!-- ===== SCENARIO 1: ToDo 登録 ===== -->
  <g transform="translate(30, 90)">
    <rect x="0" y="0" width="360" height="800" rx="16" fill="url(#card1)" filter="url(#shadow)" stroke="#611f69" stroke-width="1.5" opacity="0.95"/>
    <rect x="0" y="0" width="360" height="52" rx="16" fill="#611f69" opacity="0.7"/>
    <rect x="0" y="30" width="360" height="22" fill="#611f69" opacity="0.7"/>
    <text x="180" y="35" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">📝  シナリオ1: ToDo 登録</text>

    <!-- Step 1: User posts -->
    <g transform="translate(30, 75)">
      <rect x="0" y="0" width="300" height="70" rx="10" fill="#2a2040" stroke="#7c5cbf" stroke-width="1"/>
      <text x="20" y="22" fill="#b39ddb" font-size="11" font-weight="bold">USER</text>
      <text x="20" y="42" fill="#e0e0e0" font-size="13">#cerberus-inbox に投稿</text>
      <text x="20" y="59" fill="#aaa" font-size="11">「明日までに企画書を書く」</text>
    </g>

    <!-- Arrow -->
    <line x1="180" y1="150" x2="180" y2="180" stroke="#7c5cbf" stroke-width="2" marker-end="url(#arrowPurple)"/>
    <polygon points="175,178 185,178 180,188" fill="#7c5cbf"/>

    <!-- Step 2: AI Classifier -->
    <g transform="translate(30, 192)">
      <rect x="0" y="0" width="300" height="80" rx="10" fill="#2a2040" stroke="#7c5cbf" stroke-width="1"/>
      <text x="20" y="22" fill="#b39ddb" font-size="11" font-weight="bold">AI 分類器 (classifier.ts)</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">intent: "todo" と判定</text>
      <text x="20" y="62" fill="#aaa" font-size="11">既存の6分類 + 新しい todo intent</text>
    </g>

    <!-- Arrow -->
    <polygon points="175,280 185,280 180,290" fill="#7c5cbf"/>

    <!-- Step 3: DB Save -->
    <g transform="translate(30, 296)">
      <rect x="0" y="0" width="300" height="90" rx="10" fill="#2a2040" stroke="#7c5cbf" stroke-width="1"/>
      <text x="20" y="22" fill="#b39ddb" font-size="11" font-weight="bold">DATABASE</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">todos テーブルに保存</text>
      <text x="20" y="62" fill="#aaa" font-size="11">status: "pending"</text>
      <text x="20" y="78" fill="#aaa" font-size="11">content, due_date, slack_message_ts</text>
    </g>

    <!-- Arrow -->
    <polygon points="175,394 185,394 180,404" fill="#7c5cbf"/>

    <!-- Step 4: Slack reply -->
    <g transform="translate(30, 410)">
      <rect x="0" y="0" width="300" height="80" rx="10" fill="#2a2040" stroke="#7c5cbf" stroke-width="1"/>
      <text x="20" y="22" fill="#b39ddb" font-size="11" font-weight="bold">SLACK 返信</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">📝 ToDo として保存しました</text>
      <text x="20" y="62" fill="#aaa" font-size="11">✅ を付けると完了にできます</text>
    </g>

    <!-- Note -->
    <g transform="translate(30, 520)">
      <rect x="0" y="0" width="300" height="60" rx="8" fill="#1a1230" stroke="#555" stroke-width="1" stroke-dasharray="4,3"/>
      <text x="20" y="22" fill="#888" font-size="11" font-weight="bold">💡 ポイント</text>
      <text x="20" y="42" fill="#777" font-size="11">Claude SDK の実行は不要（軽量処理）</text>
    </g>
  </g>

  <!-- ===== SCENARIO 2: Daily Plan 表示 ===== -->
  <g transform="translate(420, 90)">
    <rect x="0" y="0" width="360" height="800" rx="16" fill="url(#card2)" filter="url(#shadow)" stroke="#36C5F0" stroke-width="1.5" opacity="0.95"/>
    <rect x="0" y="0" width="360" height="52" rx="16" fill="#1b6080" opacity="0.7"/>
    <rect x="0" y="30" width="360" height="22" fill="#1b6080" opacity="0.7"/>
    <text x="180" y="35" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">🌅  シナリオ2: Daily Plan 表示</text>

    <!-- Step 1: Cron -->
    <g transform="translate(30, 75)">
      <rect x="0" y="0" width="300" height="60" rx="10" fill="#1a2a3a" stroke="#36C5F0" stroke-width="1"/>
      <text x="20" y="22" fill="#81d4fa" font-size="11" font-weight="bold">CRON SCHEDULER</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">毎朝 3:50 AM (JST) 実行</text>
    </g>

    <!-- Arrow -->
    <polygon points="175,140 185,140 180,150" fill="#36C5F0"/>

    <!-- Step 2: Data collection -->
    <g transform="translate(30, 156)">
      <rect x="0" y="0" width="300" height="130" rx="10" fill="#1a2a3a" stroke="#36C5F0" stroke-width="1"/>
      <text x="20" y="22" fill="#81d4fa" font-size="11" font-weight="bold">データ収集 (collectDailyData)</text>
      <text x="20" y="48" fill="#e0e0e0" font-size="12">📅 Google Calendar の予定</text>
      <text x="20" y="68" fill="#e0e0e0" font-size="12">📧 未対応メール</text>
      <text x="20" y="88" fill="#e0e0e0" font-size="12">📋 未完了 inbox タスク</text>
      <text x="20" y="112" fill="#4dd0e1" font-size="13" font-weight="bold">📝 未完了 ToDo ← NEW!</text>
    </g>

    <!-- Arrow -->
    <polygon points="175,294 185,294 180,304" fill="#36C5F0"/>

    <!-- Step 3: Block Kit -->
    <g transform="translate(30, 310)">
      <rect x="0" y="0" width="300" height="200" rx="10" fill="#1a2a3a" stroke="#36C5F0" stroke-width="1"/>
      <text x="20" y="22" fill="#81d4fa" font-size="11" font-weight="bold">#daily-plan に投稿 (Block Kit)</text>

      <!-- Mock Slack message -->
      <rect x="15" y="36" width="270" height="150" rx="6" fill="#222d3a" stroke="#334" stroke-width="1"/>
      <text x="28" y="56" fill="#fff" font-size="12" font-weight="bold">🌅 2月12日(水) のプラン</text>
      <line x1="28" y1="64" x2="262" y2="64" stroke="#444" stroke-width="0.5"/>
      <text x="28" y="80" fill="#ccc" font-size="10">📅 予定: 3件</text>
      <text x="28" y="96" fill="#ccc" font-size="10">📧 未対応メール: 2件</text>
      <text x="28" y="112" fill="#ccc" font-size="10">📋 inbox: 1件</text>
      <line x1="28" y1="120" x2="262" y2="120" stroke="#444" stroke-width="0.5"/>
      <text x="28" y="137" fill="#4dd0e1" font-size="11" font-weight="bold">📝 ToDo (2件)</text>
      <text x="28" y="154" fill="#aaa" font-size="10">☐ 明日までに企画書を書く</text>
      <text x="28" y="170" fill="#aaa" font-size="10">☐ チームMTGのアジェンダ作成</text>
    </g>
  </g>

  <!-- ===== SCENARIO 3: ToDo 完了 ===== -->
  <g transform="translate(810, 90)">
    <rect x="0" y="0" width="360" height="800" rx="16" fill="url(#card3)" filter="url(#shadow)" stroke="#2eb67d" stroke-width="1.5" opacity="0.95"/>
    <rect x="0" y="0" width="360" height="52" rx="16" fill="#1b6040" opacity="0.7"/>
    <rect x="0" y="30" width="360" height="22" fill="#1b6040" opacity="0.7"/>
    <text x="180" y="35" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">✅  シナリオ3: ToDo 完了</text>

    <!-- Pattern A -->
    <g transform="translate(30, 75)">
      <rect x="0" y="0" width="300" height="44" rx="8" fill="#1b3a2a" stroke="#2eb67d" stroke-width="1"/>
      <text x="150" y="28" text-anchor="middle" fill="#81c784" font-size="13" font-weight="bold">パターン A: リアクション</text>
    </g>

    <g transform="translate(30, 135)">
      <rect x="0" y="0" width="300" height="70" rx="10" fill="#1a2a20" stroke="#2eb67d" stroke-width="1"/>
      <text x="20" y="22" fill="#81c784" font-size="11" font-weight="bold">USER ACTION</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">元の ToDo メッセージに</text>
      <text x="20" y="62" fill="#e0e0e0" font-size="13">✅ リアクションを付ける</text>
    </g>

    <polygon points="175,210 185,210 180,220" fill="#2eb67d"/>

    <g transform="translate(30, 226)">
      <rect x="0" y="0" width="300" height="70" rx="10" fill="#1a2a20" stroke="#2eb67d" stroke-width="1"/>
      <text x="20" y="22" fill="#81c784" font-size="11" font-weight="bold">SYSTEM</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">slack_message_ts で ToDo を特定</text>
      <text x="20" y="62" fill="#e0e0e0" font-size="13">→ status: "completed" に更新</text>
    </g>

    <!-- Divider -->
    <line x1="40" y1="330" x2="340" y2="330" stroke="#555" stroke-width="1" stroke-dasharray="6,4"/>
    <text x="180" y="350" text-anchor="middle" fill="#666" font-size="11">or</text>

    <!-- Pattern B -->
    <g transform="translate(30, 370)">
      <rect x="0" y="0" width="300" height="44" rx="8" fill="#1b3a2a" stroke="#2eb67d" stroke-width="1"/>
      <text x="150" y="28" text-anchor="middle" fill="#81c784" font-size="13" font-weight="bold">パターン B: テキスト</text>
    </g>

    <g transform="translate(30, 430)">
      <rect x="0" y="0" width="300" height="70" rx="10" fill="#1a2a20" stroke="#2eb67d" stroke-width="1"/>
      <text x="20" y="22" fill="#81c784" font-size="11" font-weight="bold">USER</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">#cerberus-inbox に投稿</text>
      <text x="20" y="62" fill="#aaa" font-size="11">「企画書終わった」</text>
    </g>

    <polygon points="175,506 185,506 180,516" fill="#2eb67d"/>

    <g transform="translate(30, 522)">
      <rect x="0" y="0" width="300" height="80" rx="10" fill="#1a2a20" stroke="#2eb67d" stroke-width="1"/>
      <text x="20" y="22" fill="#81c784" font-size="11" font-weight="bold">AI 分類器</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">intent: "todo_complete" と判定</text>
      <text x="20" y="64" fill="#aaa" font-size="11">既存 ToDo リストから対応を特定</text>
    </g>

    <polygon points="175,610 185,610 180,620" fill="#2eb67d"/>

    <g transform="translate(30, 626)">
      <rect x="0" y="0" width="300" height="70" rx="10" fill="#1a2a20" stroke="#2eb67d" stroke-width="1"/>
      <text x="20" y="22" fill="#81c784" font-size="11" font-weight="bold">SLACK 返信</text>
      <text x="20" y="44" fill="#e0e0e0" font-size="13">✅「企画書を書く」を完了にしました</text>
      <text x="20" y="62" fill="#aaa" font-size="11">残り ToDo: 1件</text>
    </g>
  </g>

  <!-- Footer -->
  <text x="600" y="908" text-anchor="middle" fill="#555" font-size="11">Cerberus ToDo Management — inbox × Daily Plan 統合設計</text>
</svg>