# スライドコンテンツ生成プロンプト

## 概要

structure.json を入力として受け取り、各スライドの具体的なコンテンツを生成する。
構成（セクション分割・レイアウト選択・流れ）は確定済みの前提で、各スライドの heading、bullets、visual、notes 等を埋める。

---

## 入力

- **構成ファイル**: {structure_json_path}
- **参考資料**: {reference_materials}

---

## レイアウト別 生成ガイドライン

### title

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, subtitle |
| オプション | notes |

- **使うべき場面**: プレゼンテーションの表紙。聴衆が最初に目にするスライド。
- **生成のコツ**: heading はプレゼン全体の主題を端的に表す（20文字以内推奨）。subtitle は聴衆にとっての価値を一文で伝える（「何が得られるか」を意識）。
- **注意点**: 抽象的なタイトル（「XXXについて」「XXXの紹介」）は避ける。問いかけ型や数字入りが効果的。

### section

| 区分 | フィールド |
|------|-----------|
| 必須 | heading |
| オプション | notes |

- **使うべき場面**: 大きな話題の切り替わりを示す区切りスライド。
- **生成のコツ**: heading はそのセクションで聴衆が理解すべきことを1フレーズで表現する。「背景」「まとめ」のような汎用語ではなく、内容を反映した具体的な表現にする。
- **注意点**: 前後のスライドとトーンが断絶しないよう、接続を意識する。notes にはセクション全体の狙いを書いておくと発表者の助けになる。

### text-only

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, bullets（3-5個、各15-30文字） |
| オプション | body, notes |

- **使うべき場面**: テキスト情報だけで十分に伝わる内容。定義の列挙、手順の概要、ポイントの整理など。
- **生成のコツ**: bullets は「名詞止め」ではなく「動詞 or 結論を含む文」にする。各 bullet が独立して意味をなすこと。heading は bullets の上位概念を示す。
- **注意点**: 6個以上の bullet は認知負荷が高い。5個を超える場合はスライドを分割する。body は bullets の補足説明が必要な場合のみ使用。

### text-and-image

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, bullets, visual |
| オプション | notes |

- **使うべき場面**: テキストだけでは伝わりにくい概念を図解で補強したいとき。アーキテクチャ説明、プロセスフロー、Before/After など。
- **生成のコツ**: bullets とビジュアルが補完関係にあること。bullets で「何を」「なぜ」を述べ、visual で「どのように」を示す構成が効果的。
- **注意点**: bullets とビジュアルが同じ情報を重複して伝えないこと。ビジュアルは bullets では表現しにくい構造・関係性・流れに使う。

### image-full

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, visual |
| オプション | notes |

- **使うべき場面**: ビジュアルが主役のスライド。複雑なアーキテクチャ図、データの可視化、インパクトのある画像など。
- **生成のコツ**: heading はビジュアルの読み方・注目ポイントを示す。「システム構成図」ではなく「リクエストは3層を経由してDBに到達する」のように、ビジュアルから読み取るべきメッセージを heading にする。
- **注意点**: ビジュアルだけで自己完結しないスライドは text-and-image を選ぶ。notes にはビジュアルの補足説明を必ず入れる（発表者がビジュアルを説明できるように）。

### comparison

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, leftColumn, rightColumn |
| オプション | notes |

- **使うべき場面**: 2つの選択肢・手法・状態を対比するとき。技術比較、Before/After、Pros/Cons など。
- **生成のコツ**: leftColumn と rightColumn は同じ観点（軸）で対比する。heading は比較の結論 or 観点を示す（「Redis vs Memcached」ではなく「永続化が必要なら Redis を選ぶ」）。各 column は `heading` と `bullets`（配列）を持つ。
- **注意点**: 3つ以上の比較対象がある場合はこのレイアウトに無理に押し込めず、表形式のビジュアルを検討する。bullets の数は左右で揃える。

### quote

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, quote, attribution |
| オプション | notes |

- **使うべき場面**: 権威ある発言・データ・統計で主張を裏付けるとき。セクションの導入や締めくくりに効果的。
- **生成のコツ**: quote は50文字以内に収める（長い引用は要約する）。attribution は「出典名, 年」の形式。heading は引用から聴衆が汲み取るべきメッセージを示す。
- **注意点**: 出典不明の引用は使わない。quote の内容がプレゼンの文脈と直接関連していること。装飾目的だけの引用は避ける。

### key-number

| 区分 | フィールド |
|------|-----------|
| 必須 | heading |
| オプション | bullets, notes |

- **使うべき場面**: インパクトのある数値（売上、成長率、コスト削減額など）を大きく見せたいとき。
- **生成のコツ**: heading は数値の意味・文脈を示す（「コスト削減」ではなく「年間運用コストを半減」）。bullets の1つ目が数値として大きく表示される。2つ目以降は補足説明。design.json で keyNumber（value, unit, caption）が指定される。
- **注意点**: 数値は1つだけ。複数の数値を並べたい場合は別スライドに分ける。

### timeline

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, bullets |
| オプション | notes |

- **使うべき場面**: 時系列の流れ（マイルストーン、ロードマップ、プロジェクト計画）を示すとき。
- **生成のコツ**: 各 bullet は `**時期** 内容` の形式で書く（例: `**2025年Q1** MVP リリース`）。heading は全体の流れを要約する。3-5ステップが最適。
- **注意点**: 6ステップ以上は見づらい。長い場合はスライドを分割する。

### icon-grid

| 区分 | フィールド |
|------|-----------|
| 必須 | heading, bullets |
| オプション | notes |

- **使うべき場面**: 複数の要素をカード型のグリッドで並べたいとき。特徴一覧、メリット、チーム紹介など。
- **生成のコツ**: 各 bullet は `**ラベル** 説明文` の形式で書く（例: `**高速処理** 100msec以内のレスポンスを保証`）。4つが最適（2x2グリッド）。heading はグリッド全体のテーマを示す。
- **注意点**: 5つ以上は画面が狭くなる。各項目の説明は1-2文に収める。

---

## visual フィールドの書き方ガイド

visual フィールドはスライド内のビジュアル要素を指定する。type と tool の組み合わせで生成方法が決まる。

### type と tool の対応

| type | tool | 用途 |
|------|------|------|
| diagram | `mermaid` | フローチャート、シーケンス図、ER図、状態遷移図など Mermaid 記法で表現できるもの |
| diagram | `svg-diagram` | Mermaid では表現しにくい自由度の高い図。ネットワーク構成図、カスタムレイアウトなど |
| chart | `svg-diagram` | 棒グラフ、折れ線グラフ、円グラフなどのデータ可視化 |
| image | `gen-ai-image` | 写真風のイメージ、イラスト、概念的なビジュアル |
| rich | `gen-rich-image` | 上記のいずれにも当てはまらない複合的なビジュアル（最終手段） |

### tool 選択の優先順位

```
mermaid（最優先: 構造化された図は Mermaid で表現）
  ↓ Mermaid の記法では表現できない
svg-diagram（自由度の高い SVG を直接生成）
  ↓ 図ではなくイメージが必要
gen-ai-image（AI 画像生成）
  ↓ 上記のいずれにも当てはまらない
gen-rich-image（最終手段: 複合ビジュアル）
```

### description の書き方

description は生成ツールへの指示となるため、具体的に書く。

**悪い例**:
```
"description": "フロー図"
```

**良い例**:
```
"description": "ユーザー登録 → メール認証 → ダッシュボード表示の3ステップフロー図。各ステップにアイコンを添え、認証ステップでは分岐（成功/失敗）を示す"
```

**悪い例**:
```
"description": "アーキテクチャ図"
```

**良い例**:
```
"description": "クライアント(React) → API Gateway(nginx) → Backend(Node.js) → DB(PostgreSQL) の4層構成図。各層間の通信プロトコル(HTTPS, gRPC, TCP)をラベル表示"
```

### description に含めるべき情報

1. **何を描くか** -- 対象の名前と種類
2. **構成要素** -- 登場するノード・エンティティの列挙
3. **関係性** -- 矢印の方向、データの流れ、依存関係
4. **強調ポイント** -- 注目してほしい箇所（色分け、太線、ラベル等）
5. **スタイルヒント** -- 必要であればトーン（ビジネス向け、カジュアル等）

### description の品質チェックリスト

description を書いたら以下を確認:

1. **何を描くか** が明記されているか（「フロー図」ではなく「ユーザー登録→認証→ダッシュボード表示の3ステップフロー図」）
2. **構成要素** が列挙されているか（登場するノード・エンティティ）
3. **関係性** が示されているか（矢印の方向、データの流れ）
4. **強調ポイント** があるか（注目箇所の色分け等）
5. **スタイルヒント** があるか（tech系ダーク、ビジネス系ライト等）

---

## スピーカーノート（notes）の書き方

notes は発表者が見る補足情報。聴衆には表示されない。

### 含めるべき内容

- **話すポイント**: このスライドで必ず伝えるべきメッセージ（1-2文）
- **補足情報**: スライドに載せなかったが質問されそうなデータや背景
- **聴衆への問いかけ**: 「ここで質問を受け付ける」「挙手を促す」等のインタラクション指示

### 分量

200文字以内を目安とする。長すぎる notes は発表中に読めない。

### 例

```
メインメッセージ: 認証基盤刷新の最大の動機はスケーラビリティ。
補足: 現行システムは月間80万リクエストで応答時間が2倍に悪化したデータあり（2025Q4計測）。
問いかけ: 「皆さんのチームでも認証周りでボトルネックを感じたことはありますか？」で対話を促す。
```

---

## 品質基準

### ビジュアル比率ルール（最重要）

以下のルールはプレゼン品質の根幹であり、違反は禁止。text-only スライドにデフォルトする傾向を防ぐために、必ず適用すること。

#### 比率制約

1. **text-only は全非構造スライド（title/section を除く）の最大20%**
   - 5枚なら1枚まで、10枚なら2枚まで、20枚なら4枚まで
2. **visual フィールドを持つスライド、または構造化レイアウト（comparison, key-number, timeline, icon-grid, quote）は全非構造スライドの最低50%**
3. **text-only の連続は最大2枚まで**

#### コンテンツタイプ別レイアウト選択

各スライドの情報タイプを分析し、最適なレイアウトを選択する:

| 情報の特徴 | 推奨レイアウト |
|-----------|--------------|
| 数値が主役 | `key-number` |
| 時系列・手順 | `timeline` |
| 比較・対照 | `comparison` |
| 特徴列挙（3-4項目） | `icon-grid` |
| 仕組み・構造の説明 | `text-and-image` + svg-diagram |
| データの可視化 | `image-full` + chart |
| 権威ある引用 | `quote` |

#### text-only を選択してよいケース

- 定義・概念の説明で図解が不適な場合
- 参考リソース・リンクの一覧
- クロージングのまとめ（ただし icon-grid の方が良いことが多い）

#### text-only を選択してはいけないケース

- 数値データがある → `key-number` または chart
- 比較要素がある → `comparison`
- 時系列がある → `timeline`
- 3つ以上の並列項目 → `icon-grid`
- プロセス/フローがある → `text-and-image` + mermaid/svg-diagram

### 最重要ルール: 「抽象 → 具体」の原則

すべての heading、bullet、visual description において、抽象的な表現を避け、具体的な数字・固有名詞・状況描写を含める。

### 悪い例

```json
{
  "heading": "導入",
  "bullets": ["背景", "目的", "概要"]
}
```

問題点:
- heading が汎用的すぎて内容が伝わらない
- bullets が名詞の羅列で、何も情報を与えていない
- このスライドを見ても聴衆は何も学べない

### 良い例

```json
{
  "heading": "なぜ今、認証基盤を刷新するのか",
  "bullets": [
    "現行システムのセッション管理がスケールしない（月間100万リクエスト超過）",
    "OAuth 2.0 + PKCE への移行で外部IdP連携が可能に",
    "移行期間中も既存ユーザーへの影響ゼロを保証"
  ]
}
```

優れている点:
- heading が問いの形で聴衆の関心を引く
- 各 bullet に数字・技術名・具体的な約束が含まれている
- 3つの bullet がそれぞれ「課題」「解決策」「制約」と役割が分かれている

### comparison レイアウトの例

**悪い例**:
```json
{
  "heading": "比較",
  "leftColumn": { "heading": "A案", "bullets": ["早い", "安い"] },
  "rightColumn": { "heading": "B案", "bullets": ["遅い", "高い"] }
}
```

**良い例**:
```json
{
  "heading": "段階移行（A案）なら既存ユーザーへの影響をゼロにできる",
  "leftColumn": {
    "heading": "A案: 段階移行",
    "bullets": [
      "既存セッションを維持したまま新基盤を並行稼働",
      "移行期間3ヶ月、チーム負荷は+20%",
      "ロールバックが容易（旧基盤が生きている）"
    ]
  },
  "rightColumn": {
    "heading": "B案: 一括切り替え",
    "bullets": [
      "切り替え日に全ユーザーが強制ログアウト",
      "移行期間1週間、ただし障害時の影響が全ユーザーに及ぶ",
      "ロールバック不可（旧基盤を破棄するため）"
    ]
  }
}
```

### visual の例

**悪い例**:
```json
{
  "type": "diagram",
  "tool": "mermaid",
  "description": "システム構成"
}
```

**良い例**:
```json
{
  "type": "diagram",
  "tool": "mermaid",
  "description": "認証フロー: ブラウザ → Auth Gateway → Token Service → User DB の順にリクエストが流れるシーケンス図。Token Service で JWT を発行し、以降のリクエストでは Gateway が JWT を検証して Backend に転送する流れを示す"
}
```

---

## 出力形式

slides-content.json のスキーマに準拠した JSON を出力する。

### 構造

```json
{
  "slides": [
    {
      "id": "slide-title",
      "sectionId": "structure.json の sections[].id と対応",
      "layout": "title",
      "heading": "...",
      "subtitle": "...",
      "notes": "..."
    },
    {
      "id": "slide-problem-1",
      "sectionId": "problem",
      "layout": "text-only",
      "heading": "...",
      "bullets": ["...", "...", "..."],
      "notes": "..."
    },
    {
      "id": "slide-solution-1",
      "sectionId": "solution",
      "layout": "text-and-image",
      "heading": "...",
      "bullets": ["...", "..."],
      "visual": {
        "type": "diagram",
        "tool": "mermaid",
        "description": "..."
      },
      "notes": "..."
    }
  ]
}
```

### ルール

1. slides 配列の各要素は、structure.json の sections の各セクションに対応する `sectionId` を持つこと
2. 各スライドには一意の `id` を付ける（画像ファイル名に使用される）
3. 各スライドの `layout` は structure.json で指定されたレイアウトに従う
4. レイアウトごとの必須フィールドは必ず含める（上記ガイドライン参照）
5. オプションフィールドは、発表の質を高める場合にのみ含める
6. JSON として valid であること（末尾カンマ、コメント不可）
7. **ビジュアル比率セルフチェック**: 生成後、以下を確認してから出力する
   - text-only が全非構造スライドの20%以下か
   - visual を持つスライド + 構造化レイアウト（comparison, key-number, timeline, icon-grid, quote）が50%以上か
   - text-only が3枚以上連続していないか
   - 数値データを含むスライドに key-number / chart を使っているか
   - 比較要素に comparison を使っているか
   - 違反がある場合、レイアウトを変更してから出力する
